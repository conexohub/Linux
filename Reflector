O que é o Refletor?
O Refletor é um módulo e script simples, Python 3, que verifica e recupera a lista de espelhamento mais atualizada classificada pela velocidade da página Status do Espelho e salva-as em /etc/pacman.d/mirrorlist no seu sistema Arch Linux.

Geralmente, o arquivo /etc/pacman.d/mirrorlist conterá um servidor espelho por país. No entanto, deve haver mais de apenas um servidor por país, mas o arquivo da lista de espelhos geralmente terá apenas um.

Então, como você adiciona ou recupera a lista de espelhos mais recentes e atualizadas de sua escolha no Arch Linux? É aqui que o Refletor vem em ajuda.

O Refletor recuperará e filtrará uma lista dos mais recentes, bem como os espelhos Arch Linux mais rápidos com base na velocidade, país e idade (última sincronização do servidor).

O Ref refletedor é script Python gratuito e de código aberto, que funciona muito bem no Arch Linux e seus derivados como EndeavourOS e Manjaro Linux.

1. Instale o Refletor em Arch Linux, EndeavourOS, Manjaro
Para instalar o Reflector no Arch Linux e suas variantes como EndeavourOS e Manjaro, execute o seguinte comando do seu Terminal:

$ sudo pacman -S reflector rsync curl
O comando acima instalará o Reflector junto com suas dependências rsync e pacotes de cachos.

2. Recupere a lista de espelhos mais recente usando o Refletor no Arch Linux
2.1. Lista de espelhos de corrente de backup

Antes de executar o Refletor, você deve fazer backup do arquivo padrão da lista de espelhos. Porque, o Refletor irá substituí-lo e substituir a lista de espelhos existente por uma nova.

Para fazer backup da lista de espelhos atuais, execute:

$ sudo cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.bak
2.2. Recuperar os últimos espelhos N e classificar por taxa de download

Vamos recuperar os 20 espelhos mais recentes e classificar a lista de espelhos pela sua taxa de download, e salvá-los em arquivo usando o comando:/etc/pacman.d/mirrorlist

$ sudo reflector --latest 20 --protocol https --sort rate --save /etc/pacman.d/mirrorlist
Por favor, note que isso substituirá os espelhos existentes por novos espelhos.

Vamos quebrar o comando acima e ver o que cada opção faz.

--latest 20 - buscar os servidores sincronizados mais recentemente
--protocol https - recuperar espelhos habilitadoshttps
--sort rate - classificar a lista de espelhamento com base na taxa de download
--save /etc/pacman.d/mirrorlist -
Você pode verificar isso listando o conteúdo do arquivo./etc/pacman.d/mirrorlist

$ cat /etc/pacman.d/mirrorlist
Saída da amostra:

 #####################################################################
 ########### Arch Linux mirrorlist generated by Reflector  ###########
 #####################################################################
 With:       reflector --latest 20 --protocol https --sort rate --save /etc/pacman.d/mirrorlist
 When:       2021-06-10 09:51:51 UTC
 From:       https://www.archlinux.org/mirrors/status/json/
 Retrieved:  2021-06-10 09:49:34 UTC
 Last Check: 2021-06-10 09:15:02 UTC
 Server = https://mirror.osbeck.com/archlinux/$repo/os/$arch
 Server = https://asia.mirror.pkgbuild.com/$repo/os/$arch
 Server = https://archlinux.thaller.ws/$repo/os/$arch
 Server = https://arch.mirror.constant.com/$repo/os/$arch
 Server = https://mirror.f4st.host/archlinux/$repo/os/$arch
 Server = https://phinau.de/arch/$repo/os/$arch
 Server = https://mirrors.neusoft.edu.cn/archlinux/$repo/os/$arch
 Server = https://mirror.pseudoform.org/$repo/os/$arch
 Server = https://arch.mirror.square-r00t.net/$repo/os/$arch
 Server = https://mirror.pkgbuild.com/$repo/os/$arch
 Server = https://archlinux.uk.mirror.allworldit.com/archlinux/$repo/os/$arch
 Server = https://archlinux.za.mirror.allworldit.com/archlinux/$repo/os/$arch
 Server = https://mirror.telepoint.bg/archlinux/$repo/os/$arch
 Server = https://mirror.lty.me/archlinux/$repo/os/$arch
 Server = https://mirror.chaoticum.net/arch/$repo/os/$arch
 Server = https://mirror.efect.ro/archlinux/$repo/os/$arch
 Server = https://archmirror.it/repos/$repo/os/$arch
 Server = https://archlinux.mailtunnel.eu/$repo/os/$arch
 Server = https://archlinux.qontinuum.space:4443/$repo/os/$arch
 Server = https://ftp.halifax.rwth-aachen.de/archlinux/$repo/os/$arch
Veja a lista de espelhos do Pacman no Arch Linux
Veja a lista de espelhos do Pacman no Arch Linux
Agora, você pode instalar, atualizar e atualizar pacotes dos espelhos mais atualizados.

$ sudo pacman -Syu
$ sudo pacman -S <package_name>
2.3. Recuperar os últimos espelhos N e classificar por idade

Para recuperar os espelhos superiores e classificá-los pela última sincronização do servidor, execute:

$ sudo reflector --latest 20 --protocol https --sort age --save /etc/pacman.d/mirrorlist
2.4. Recuperar lista de espelhos específicas do país

Você também pode restringir espelhos a países selecionados. Por exemplo, se você vive na Índia, você pode querer atualizar a lista de espelhos com os servidores apenas da Índia.

Para listar todos os espelhos Do Arch Linux disponíveis em todo o mundo, execute:

$ reflector --list-countries
Saída da amostra:

Country                Code Count
---------------------- ---- -----
Australia                AU    19
Austria                  AT     6
Bangladesh               BD     1
Belarus                  BY     4
Belgium                  BE     3
Bosnia and Herzegovina   BA     2
Brazil                   BR    11
Bulgaria                 BG    11
Canada                   CA    20
Chile                    CL     8
[...]
Como você vê na saída acima, o refletor lista os espelhos disponíveis no mundo, juntamente com o código do país e o número de espelhos em cada país.

A partir da redação deste guia, o maior número de espelhos Arch Linux está localizado nos EUA (134 espelhos), Alemanha (114) e Holanda (51).

Para recuperar um espelho de um país específico, você pode usar o nome do país ou código de país, ou uma mistura de ambos.

O comando a seguir recuperará os 5 principais espelhos da Índia, classificará-os pela taxa de download e os salvará no arquivo mirrorlist.

$ sudo reflector --verbose --country 'India' -l 5 --sort rate --save /etc/pacman.d/mirrorlist
A seguir, o breve resumo do que essas bandeiras no comando acima farão.

--verbose - imprime mais informações do que o normal.
-país Índia - minha localização espelho preferida.
--l 5 - recupera os cinco melhores espelhos da Índia.
-taxa de classificação - classifica por taxa de download.
--salvar - salvar a lista de espelhos baixada para ./etc/pacman-d/mirrorlist
Vamos verificar a lista de espelhos atualizada usando o comando:

$ cat /etc/pacman.d/mirrorlist
Saída da amostra:

################################################################################
################# Arch Linux mirrorlist generated by Reflector #########################
################################################################################

# With:       reflector --verbose --country India -l 5 --sort rate --save /etc/pacman.d/mirrorlist
# When:       2021-06-10 10:27:06 UTC
# From:       https://www.archlinux.org/mirrors/status/json/
# Retrieved:  2021-06-10 10:26:49 UTC
# Last Check: 2021-06-10 09:15:02 UTC

Server = http://mirrors.piconets.webwerks.in/archlinux-mirror/$repo/os/$arch
Server = https://mirrors.piconets.webwerks.in/archlinux-mirror/$repo/os/$arch
Server = http://mirror.cse.iitk.ac.in/archlinux/$repo/os/$arch
Infelizmente, há apenas três espelhos Arch Linux disponíveis na Índia.

2.5. Recuperar lista de espelhos de vários países

Você também pode especificar vários países com ímulas separadas como abaixo.

$ sudo reflector --country 'United States,India' -l 10 --age 12 --protocol https --sort rate --save /etc/pacman.d/mirrorlist 
Este comando selecionará os 10 principais espelhos HTTPS sincronizados nas últimas 12 horas e localizados nos Estados Unidos ou na Índia, classificar-os pela velocidade de download e substituir o arquivo de arquivo./etc/pacman.d/mirrorlist

2.6. Recuperar a lista de espelhos classificadas pelo país

Para que toda a lista classificada para o país execute o seguinte comando:

$ sudo curl -o /etc/pacman.d/mirrorlist https://archlinux.org/mirrorlist/all/
Depois de recuperar os espelhos classificados no país, edite seu arquivo /etc/pacman.d/mirrorlist:

$ sudo nano /etc/pacman.d/mirrorlist
Descompromisse a URL do espelho de sua escolha para habilitá-la.

Por exemplo, eu habili os espelhos da Índia. Então, removi o símbolo (#) na frente de cada URL.

[...]
India
Server = http://mirror.cse.iitk.ac.in/archlinux/$repo/os/$arch
Server = http://mirrors.piconets.webwerks.in/archlinux-mirror/$repo/os/$arch
Server = https://mirrors.piconets.webwerks.in/archlinux-mirror/$repo/os/$arch
[...]
Lista de espelhos classificados por país no Arch Linux
Lista de espelhos classificados por país no Arch Linux
Salve e feche o arquivo. Atualizar listas de repositórios usando o comando:

$ sudo pacman -Syu
2.7. Selecione espelhos mais rápidos

O Refletor pode recuperar um espelho mais rápido para o seu Arch Linux.

O comando a seguir recupera os 5 espelhos HTTPS mais rápidos localizados nos Estados Unidos, classifica-os por velocidade de download e sobregrava o arquivo de arquivo./etc/pacman.d/mirrorlist

$ sudo reflector -f 5 --country 'United States' --protocol https --sort rate --save /etc/pacman.d/mirrorlist 
2.8. Especificar protocolo

Você pode selecionar os espelhos atualizados que suportam um tipo específico de protocolo, por exemplo, etc.httpshttpftp

Por exemplo, este comando selecionará 5 espelhos mais atualizados dos Estados Unidos que suportam e substituem arquivos:HTTP/etc/pacman.d/mirrorlist

$ sudo reflector --latest 5 --protocol http --country 'United States' --save /etc/pacman.d/mirrorlist
As outras opções suportadas são que só retornarão espelhos que hospedam ISOs, que só retornarão espelhos que suportam IPv4, e só retornam espelhos que suportam IPv6.--isos--ipv4--ipv6

3. Atualizar a lista de espelhos do Arch Linux automaticamente no inicialização
O refletor inclui unidades de serviço e temporizador que podem ser usadas para atualizar automaticamente a lista espelhada do Pacman.systemd

3.1. Habilite e inicie o serviço sistemator de refletores

A partir da versão 2020.8, o Refletor navega com . Para atualizar sua lista de espelhos do Arch Linux automaticamente em cada reinicialização, basta ativar e iniciar este serviço usando comandos:reflector.service

$ sudo systemctl enable reflector.service
$ sudo systemctl start reflector.service
O refletor.service executará o refletor com os parâmetros especificados no arquivo./etc/xdg/reflector/reflector.conf

As configurações padrão são suficientes na maior parte do tempo. Aqui está o conteúdo do arquivo:reflector.conf

$ cat /etc/xdg/reflector/reflector.conf
Saída da amostra:

#
# Empty lines and lines beginning with "#" are ignored.  All other lines should
# contain valid reflector command-line arguments. The lines are parsed with
# Python's shlex modules so standard shell syntax should work. All arguments are
# collected into a single argument list.
#
# See "reflector --help" for details.

# Recommended Options

# Set the output path where the mirrorlist will be saved (--save).
--save /etc/pacman.d/mirrorlist

# Select the transfer protocol (--protocol).
--protocol https

# Select the country (--country).
# Consult the list of available countries with "reflector --list-countries" and
# select the countries nearest to you or the ones that you trust. For example:
# --country France,Germany

# Use only the  most recently synchronized mirrors (--latest).
--latest 5

# Sort the mirrors by synchronization time (--sort).
--sort age
Você também pode editar este arquivo e alterar os parâmetros de acordo com seus requisitos. Este arquivo aceita todos os argumentos da linha de comando do refletor.

Você pode agrupar os argumentos em uma única linha ou dividir em muitas linhas, com linhas em branco opcionais e linhas de comentários começando com .#

3.2. Ativar e iniciar o temporizador sistemator do refletor

O refletor envia outra unidade sistematamente chamada , que inicia a semana.reflector.timerreflector.service

Para habilitá-lo e iniciá-lo automaticamente no inicialização do sistema, execute os seguintes comandos um a um:

$ sudo systemctl enable reflector.timer
$ sudo systemctl start reflector.timer
Por padrão, começará uma vez por semana. Se você não quiser esperar pelo horário programado, você pode iniciar o refletor.service para atualizar imediatamente a lista de espelhos do pacman:reflector.service

$ sudo systemctl start reflector.service
Conclusão
Neste guia, aprendemos o que é Reflector, como reexaminar a lista de espelhos pacman atualizado para o seu sistema Arch Linux usando script Refutor e, finalmente, como atualizar a lista de espelhos do Arch Linux automaticamente.

Recurso:

Wiki refletor
